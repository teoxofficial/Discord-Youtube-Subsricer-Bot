const { SlashCommandBuilder, PermissionFlagsBits } = require('discord.js');

module.exports = {
  data: new SlashCommandBuilder()
    .setName('format-ayar')
    .setDescription('İzin verilen dosya formatlarını ayarlar (Sadece Yöneticiler)')
    .setDefaultMemberPermissions(PermissionFlagsBits.Administrator)
    .addStringOption(option =>
      option.setName('formatlar')
        .setDescription('İzin verilen formatları virgülle ayırarak yazın (örn: .png,.jpg,.jpeg)')
        .setRequired(true)),
  async execute(interaction) {
    const formatsInput = interaction.options.getString('formatlar');
    const formats = formatsInput.split(',').map(f => f.trim().toLowerCase());
    
    // Geçerli formatları kontrol et
    const validFormats = ['.png', '.jpg', '.jpeg', '.gif', '.webp', '.bmp'];
    const invalidFormats = formats.filter(f => !validFormats.includes(f));
    
    if (invalidFormats.length > 0) {
      return await interaction.reply({ 
        content: `❌ Geçersiz formatlar: ${invalidFormats.join(', ')}\nGeçerli formatlar: ${validFormats.join(', ')}`,
        ephemeral: true 
      });
    }
    
    // Config güncelleme
    interaction.client.config.allowedFormats = formats;
    
    // Config dosyasını güncelle
    const fs = require('fs');
    fs.writeFileSync('./config.json', JSON.stringify(interaction.client.config, null, 2));
    
    await interaction.reply({ 
      content: `✅ İzin verilen formatlar güncellendi: ${formats.join(', ')}`,
      ephemeral: true 
    });
  },
};